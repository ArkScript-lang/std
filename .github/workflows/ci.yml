name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout std
        uses: actions/checkout@v2
        
      - name: Download Linux artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          github_token: ${{secrets.GITHUB_TOKEN}}
          workflow: ci.yml
          branch: dev
          name: ubuntu-gcc-10
          path: bin
          repo: ArkScript-lang/Ark
      
      - name: Set up files
        shell: bash
        run: |
          cd bin
          cp lib/*.arkm ../
          chmod u+x arkscript *.so
          cp arkscript ../
          cp *.so ../

      - name: Tests
        shell: bash
        run: |
          ./arkscript --version
          if [ -f tests/all.ark ]; then
            ./arkscript tests/all.ark -L ./
          else
            echo "No tests found"
          fi
