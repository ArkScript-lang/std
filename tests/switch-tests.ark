(import tests-tools)

(import std.Switch)

(let switch-tests (fun () {
    (mut tests 0)
    (let start-time (time))

    (switch 12 [
        [0    (fun () (assert-val false "switch 12" tests))]
        [-1   (fun () (assert-val false "switch 12" tests))]
        [nil  (fun () (assert-val false "switch 12" tests))]
        ["12" (fun () (assert-val false "switch 12" tests))]
        [[12] (fun () (assert-val false "switch 12" tests))]
        [12   (fun () (set tests (assert-val true "switch 12" tests)))]
        [true (fun () (assert-val false "switch 12" tests))]])

    # FIXME: this is crashing the GCC8 and GCC11 builds
    # (switch 0 [
    #     [nil  '(assert-val false "switch 0" tests)]
    # ])
    # (set tests (assert-val true "switch 0" tests))

    (recap "Switch tests passed" tests (- (time) start-time))

    tests }))

(let passed-switch (switch-tests))